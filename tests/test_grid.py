# import pytest

from pathfinding.grid import Grid


def test_size_grid():
    square = """######
#....#
#....#
#....#
#....#
######"""
    grid = Grid(6, 6)
    assert grid.h == 6
    assert grid.w == 6


def test_load_grid():
    square = """######
#....#
#....#
#....#
#....#
######"""
    grid = Grid(6, 6)
    grid.load(square.splitlines())
    assert square == "{}".format(grid)


def test_point_grid():
    square = """######
#....#
#....#
#....#
#....#
######"""
    grid = Grid(6, 6)
    grid.load(square.splitlines())
    start = grid.get(1, 1)
    assert start.topography == "."
    assert list(start.neighbors()) == [(1, 2), (2, 1), (1, 0), (0, 1)]
    assert list(grid.neighbors(start)) == [
        grid.get(1, 2),
        grid.get(2, 1),
        grid.get(1, 0),
        grid.get(0, 1),
    ]
    assert list(grid.neighbors(start, walk=True)) == [
        grid.get(1, 2),
        grid.get(2, 1),
    ]


def test_exploration():
    square = """???
?.?
???"""
    grid = Grid(3, 3)
    grid.load(square.splitlines())
    pt = grid.get(1, 1)
    assert grid.unknown(pt) is True

    assert list(grid.incognita()) == [pt]



def test_direction():
    square = """...
...
..."""
    grid = Grid(3, 3)
    grid.load(square.splitlines())
    pt = grid.get(1, 1)
    up = grid.get(0, 1)
    down = grid.get(2, 1)
    left = grid.get(1, 0)
    right = grid.get(1, 2)

    assert pt.direction(up) == "UP"
    assert pt.direction(down) == "DOWN"
    assert pt.direction(left) == "LEFT"
    assert pt.direction(right) == "RIGHT"


def test_explore_path():
    square = """??????
?####?
?....?
?####?
??????"""
    grid = Grid(6, 5)
    grid.load(square.splitlines())
    pt1 = grid.get(2, 1)
    pt2 = grid.get(2, 4)
    assert list(grid.incognita()) == [pt1, pt2]

    pt = grid.get(2, 3)

    assert grid.explore(pt) == pt2

    assert grid.move(pt) == "RIGHT"


def test_distance():
    square = """######
T....C
######"""
    grid = Grid(6, 3)
    grid.load(square.splitlines())
    assert grid.room() == grid.get(1, 5)
    assert grid.gate() == grid.get(1, 0)

    assert len(grid.astar(grid.room(), grid.gate())) == 6


def test_maze():
    square = """???????????????????????...##??
???????????????????????#####??
???????????????????????...##??
???????????????????????####.??
???????????????????????####.??
??????????????????????????????
??????????????????????????????
??????????????????????????????
??????????????????????????????
??????????????????????????????
??????????????????????????????
??????????????????????????????
??????????????????????????????
??????????????????????????????
??????????????????????????????"""

    grid = Grid(15, 30, 21)
    grid.load(square.splitlines())

    kirk = grid.get(2, 25)

    pt = grid.get(3, 27)

    assert grid.astar(kirk, pt) == []

    move = grid.move(kirk)
    assert move == "LEFT"


def test_shortest_path():
    square = """?#############################
#............................#
#.#######################.#..#
#.....T.................#.#..#
#.....#.................#.#..#
#.#######################.#..#
#.....##......##......#....###
#...####..##..##..##..#..#...#
#.........##......##.....#...#
###########################.##
#......#......#..............#
#...C..#.....................#
#...#..####################..#
#............................#
##############################"""
    grid = Grid(15, 30, 70)
    grid.load(square.splitlines())

    len(grid.astar(grid.room(), grid.gate())) == 71

    kirk = grid.get(12, 1)
    move = grid.move(kirk)
    assert move == "LEFT"
